pipeline {
  agent none
  parameters {
    string (
      defaultValue: '',
      description: 'Branch name',
      name: 'branch'
    )
  }
  stages {
    stage('Clean workspace') {
      parallel {
        stage('Windows 64-bit clean') {
          agent { label 'win_64' }
          steps {
            cleanWorkspace("C:/oo/${params.branch}")
          }
        }
        stage('Windows 32-bit clean') {
          agent { label 'win_32' }
          steps {
            cleanWorkspace("C:/oo/${params.branch}")
          }
        }
        stage('Windows XP 64-bit clean') {
          agent { label 'win_64_xp' }
          steps {
            cleanWorkspace("C:/oo/${params.branch}")
          }
        }
        stage('Windows XP 32-bit clean') {
          agent { label 'win_32_xp' }
          steps {
            cleanWorkspace("C:/oo/${params.branch}")
          }
        }
      }
      when {
        expression { !params.branch.isEmpty() }
      }
    }
  }
}

def cleanWorkspace(String workspaceDir) {
  dir (workspaceDir) {
    deleteDir()
  }
  dir (workspaceDir+"@tmp") {
    deleteDir()
  }
  return this
}
